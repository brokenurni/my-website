<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Game Hub — Ultimate</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root {
    --accent: #10b981;
    --accent-2: #f59e0b;
  }
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #0ea5e9, #22d3ee);
    background-attachment: fixed;
    transition: background 0.4s;
  }
  .dark body {
    background: linear-gradient(135deg, #0f172a, #1f2937);
  }
  .app-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 1rem;
  }
  .topbar {
    position: sticky;
    top: 0;
    z-index: 20;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    margin: -1rem -1rem 1rem;
    background: rgba(255, 255, 255, 0.18);
    backdrop-filter: blur(8px);
    border-radius: 0 0 1rem 1rem;
  }
  .dark .topbar {
    background: rgba(0, 0, 0, 0.25);
  }
  .brand {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
  }
  .logo {
    width: 2.5rem;
    height: 2.5rem;
    display: grid;
    place-items: center;
    border-radius: 50%;
    background: conic-gradient(from 210deg, var(--accent), var(--accent-2));
    color: white;
    font-weight: 900;
  }
  .btn {
    border: none;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    background: var(--accent);
    color: white;
    box-shadow: 0 10px 24px rgba(0,0,0,.15);
    font-weight: 600;
    min-width: 3rem;
    min-height: 3rem;
    transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
  }
  .btn:hover {
    box-shadow: 0 12px 30px rgba(0,0,0,.2);
  }
  .btn:active {
    transform: scale(0.95);
  }
  .btn.secondary {
    background: transparent;
    color: inherit;
    border: 2px solid currentColor;
    box-shadow: none;
  }
  .toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.625rem;
    justify-content: space-between;
    margin-bottom: 0.875rem;
  }
  .chips {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .chip {
    padding: 0.625rem 0.875rem;
    border-radius: 999px;
    background: #f1f5f9;
    cursor: pointer;
    border: 1px solid #e2e8f0;
    transition: background-color 0.2s, outline 0.2s;
  }
  .dark .chip {
    background: #1e293b;
    border-color: #334155;
  }
  .chip.active {
    outline: 2px solid var(--accent);
    background-color: var(--accent);
    color: white;
  }
  .dark .chip.active {
    background-color: var(--accent);
  }
  .search {
    flex: 1;
    min-width: 200px;
  }
  .search input {
    width: 100%;
    padding: 0.75rem;
    border-radius: 0.75rem;
    border: 1px solid #cbd5e1;
    background: white;
  }
  .dark .search input {
    background: #1f2937;
    color: #e5e7eb;
    border-color: #334155;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }
  .card {
    background: white;
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: 0 10px 24px rgba(0,0,0,.15);
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0,0,0,.2);
  }
  .dark .card {
    background: #1f2937;
  }
  .card h3 {
    margin: 0;
    font-size: 1.1rem;
  }
  .tag {
    font-size: 0.85rem;
    opacity: 0.8;
  }
  .meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    opacity: 0.9;
  }
  .screen {
    display: none;
  }
  .screen.active {
    display: block;
  }
  .gamewrap {
    background: white;
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: 0 10px 24px rgba(0,0,0,.15);
    min-height: 50vh;
  }
  .dark .gamewrap {
    background: #1f2937;
  }
  .back-btn {
    margin-bottom: 0.75rem;
  }
  canvas {
    display: block;
    margin: 0.75rem auto;
    background: #000;
    max-width: 100%;
    height: auto;
    border-radius: 0.75rem;
    touch-action: none;
  }
  .game-message {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 1rem;
  }
  .game-message button {
    margin-top: 1rem;
  }
  .grid-ttt {
    display: grid;
    grid-template-columns: repeat(3, minmax(80px, 1fr));
    gap: 0.5rem;
    justify-content: center;
    margin: 0.75rem auto;
    max-width: 320px;
    aspect-ratio: 1/1;
  }
  .cell {
    width: 100%;
    aspect-ratio: 1/1;
    background: #f1f5f9;
    display: grid;
    place-items: center;
    border-radius: 0.625rem;
    font-size: 2.5rem;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    transition: transform 0.2s;
  }
  .cell:active {
    transform: scale(0.95);
  }
  .dark .cell {
    background: #1e293b;
  }
  .memory {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
    gap: 0.625rem;
    max-width: 420px;
    margin: auto;
  }
  .mcard {
    width: 100%;
    aspect-ratio: 1/1;
    background: #f1f5f9;
    border-radius: 0.625rem;
    display: grid;
    place-items: center;
    font-size: 1.8rem;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    transition: transform 0.2s, background-color 0.4s;
  }
  .mcard:active {
    transform: scale(0.95);
  }
  .dark .mcard {
    background: #1e293b;
  }
  .controls {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 0.75rem auto;
  }
  .control-btn {
    min-width: 3.75rem;
    min-height: 3.75rem;
    font-size: 1.2rem;
  }
  footer {
    text-align: center;
    opacity: 0.8;
    padding: 1.5rem 0.5rem;
  }
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .modal.active {
    opacity: 1;
    visibility: visible;
  }
  .modal-content {
    background-color: white;
    padding: 1.5rem;
    border-radius: 1rem;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    max-width: 90%;
    transform: scale(0.9);
    transition: transform 0.3s ease;
  }
  .modal.active .modal-content {
    transform: scale(1);
  }
  .dark .modal-content {
    background-color: #1f2937;
  }
</style>
</head>
<body>
<div class="app-container">
  <div class="topbar">
    <div class="brand">
      <div class="logo">GH</div>
      Mini Game Hub — Ultimate
    </div>
    <div class="actions">
      <button class="btn secondary" id="themeBtn">🌙</button>
      <button class="btn secondary" id="soundBtn">🔊</button>
      <button class="btn secondary" id="hapticBtn">📳</button>
    </div>
  </div>

  <section id="home" class="screen active">
    <div class="toolbar">
      <div class="chips" id="catChips">
        <div class="chip active" data-cat="all">All</div>
        <div class="chip" data-cat="arcade">Arcade</div>
        <div class="chip" data-cat="puzzle">Puzzle</div>
      </div>
      <div class="search"><input id="search" placeholder="Search games..."></div>
    </div>
    <div class="grid" id="gameGrid"></div>
  </section>

  <section id="gameView" class="screen">
    <button class="btn secondary back-btn" onclick="showHome()">⬅ Back</button>
    <div class="gamewrap">
      <h2 id="gameTitle" class="text-2xl font-bold">Game</h2>
      <div id="gameRoot"></div>
      <div id="gameMessage" class="game-message"></div>
      <div id="gameControls" class="controls"></div>
    </div>
  </section>

  <footer>© <span id="year"></span> Mini Game Hub • Local-first</footer>

  <div id="modal" class="modal">
    <div class="modal-content">
      <p id="modalMessage" class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100"></p>
      <button id="modalButton" class="btn">OK</button>
    </div>
  </div>
</div>

<script>
// --- Global Utilities & State ---
const $ = (q, el = document) => el.querySelector(q);
const $$ = (q, el = document) => [...el.querySelectorAll(q)];
const store = (k, v) => localStorage.setItem(k, JSON.stringify(v));
const load = (k, d = null) => { try { return JSON.parse(localStorage.getItem(k)) || d; } catch { return d; } };
const showModal = (message, buttonText = "Restart", onButtonClick = () => { gameManager.restartGame(); }) => {
  const modal = $('#modal');
  const modalMessage = $('#modalMessage');
  const modalButton = $('#modalButton');
  modalMessage.textContent = message;
  modalButton.textContent = buttonText;
  modal.classList.add('active');
  modalButton.onclick = () => {
    modal.classList.remove('active');
    onButtonClick();
  };
};

const gameManager = {
  currentGame: null,
  gameRoot: $('#gameRoot'),
  gameMessage: $('#gameMessage'),
  gameControls: $('#gameControls'),

  play: (game) => {
    gameManager.currentGame = game;
    $('#home').classList.remove('active');
    $('#gameView').classList.add('active');
    $('#gameTitle').textContent = game.name;
    gameManager.gameMessage.textContent = '';
    gameManager.gameControls.innerHTML = '';
    game.fn();
  },

  restartGame: () => {
    if (gameManager.currentGame) {
      gameManager.play(gameManager.currentGame);
    }
  },

  showMessage: (msg) => {
    gameManager.gameMessage.innerHTML = `<span class="text-white">${msg}</span>`;
  },

  addControl: (text, onClick) => {
    const btn = document.createElement('button');
    btn.textContent = text;
    btn.classList.add('btn', 'control-btn');
    btn.onclick = onClick;
    gameManager.gameControls.appendChild(btn);
  }
};

// --- Theme Toggle ---
const themeBtn = $('#themeBtn');
themeBtn.onclick = () => {
  document.body.classList.toggle('dark');
  store('theme', document.body.classList.contains('dark'));
};
if (load('theme')) {
  document.body.classList.add('dark');
}

// --- Game Hub Logic ---
const gameGrid = $('#gameGrid');
const games = [
  { name: 'Tic-Tac-Toe', cat: 'puzzle', fn: playTicTacToe },
  { name: 'Snake', cat: 'arcade', fn: playSnake },
  { name: 'Memory', cat: 'puzzle', fn: playMemory },
  { name: 'Flappy Bird', cat: 'arcade', fn: playFlappy }
];
function renderGames(filter = 'all') {
  gameGrid.innerHTML = '';
  games.filter(g => filter === 'all' || g.cat === filter).forEach(g => {
    const card = document.createElement('div');
    card.className = 'card cursor-pointer';
    card.innerHTML = `<h3>${g.name}</h3><div class="tag">${g.cat}</div>`;
    card.onclick = () => gameManager.play(g);
    gameGrid.appendChild(card);
  });
}
renderGames();

$$('.chip').forEach(chip => {
  chip.onclick = () => {
    $$('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    renderGames(chip.dataset.cat);
  }
});

$('#search').oninput = (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const filteredGames = games.filter(g => g.name.toLowerCase().includes(searchTerm) || g.cat.toLowerCase().includes(searchTerm));
    gameGrid.innerHTML = '';
    filteredGames.forEach(g => {
        const card = document.createElement('div');
        card.className = 'card cursor-pointer';
        card.innerHTML = `<h3>${g.name}</h3><div class="tag">${g.cat}</div>`;
        card.onclick = () => gameManager.play(g);
        gameGrid.appendChild(card);
    });
};

function showHome() {
  $('#home').classList.add('active');
  $('#gameView').classList.remove('active');
  gameManager.gameRoot.innerHTML = '';
  gameManager.gameControls.innerHTML = '';
  gameManager.gameMessage.innerHTML = '';
}

// --- Games ---

// Tic-Tac-Toe
function playTicTacToe() {
  const root = gameManager.gameRoot;
  root.innerHTML = `<div class="grid-ttt"></div>`;
  const grid = $('.grid-ttt', root);
  let board = Array(9).fill('');
  let turn = 'X';

  const checkWin = (b) => {
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for (const win of wins) {
      if (b[win[0]] !== '' && b[win[0]] === b[win[1]] && b[win[1]] === b[win[2]]) {
        return true;
      }
    }
    return false;
  };
  
  const checkDraw = (b) => !b.includes('');

  const render = () => {
    grid.innerHTML = '';
    board.forEach((v, i) => {
      const c = document.createElement('div');
      c.className = 'cell';
      c.textContent = v;
      c.style.color = v === 'X' ? '#10b981' : (v === 'O' ? '#ef4444' : '');
      c.onclick = () => {
        if (v || checkWin(board) || checkDraw(board)) return;
        board[i] = turn;
        if (checkWin(board)) {
          showModal(`Player ${turn} wins!`, 'Play Again');
        } else if (checkDraw(board)) {
          showModal('It\'s a Draw!', 'Play Again');
        }
        turn = turn === 'X' ? 'O' : 'X';
        gameManager.showMessage(`Player ${turn}'s turn`);
        render();
      };
      grid.appendChild(c);
    });
  };
  gameManager.showMessage(`Player X's turn`);
  render();
}

// Memory
function playMemory() {
  const root = gameManager.gameRoot;
  let cards = ['🍎', '🍏', '🍌', '🍋', '🍇', '🍓', '🍒', '🍊', '🍎', '🍏', '🍌', '🍋', '🍇', '🍓', '🍒', '🍊'];
  cards.sort(() => Math.random() - 0.5);
  root.innerHTML = `<div class="memory"></div>`;
  const grid = $('.memory', root);
  let flipped = [];
  let matched = [];
  let isFlipping = false;

  const render = () => {
    grid.innerHTML = '';
    cards.forEach((v, i) => {
      const c = document.createElement('div');
      c.className = 'mcard';
      c.textContent = (matched.includes(i) || flipped.includes(i)) ? v : '';
      c.style.backgroundColor = matched.includes(i) ? '#10b981' : (flipped.includes(i) ? '#f59e0b' : '');
      
      c.onclick = () => {
        if (isFlipping || flipped.includes(i) || matched.includes(i)) return;
        flipped.push(i);
        render();
        if (flipped.length === 2) {
          isFlipping = true;
          if (cards[flipped[0]] === cards[flipped[1]]) {
            matched.push(...flipped);
            flipped = [];
            isFlipping = false;
            if (matched.length === cards.length) {
              showModal('You won!', 'Play Again');
            }
          } else {
            setTimeout(() => {
              flipped = [];
              isFlipping = false;
              render();
            }, 800);
          }
        }
      };
      grid.appendChild(c);
    });
  };
  render();
}

// Snake
function playSnake() {
  const root = gameManager.gameRoot;
  root.innerHTML = `<canvas></canvas>`;
  const canvas = $('canvas', root);
  const ctx = canvas.getContext('2d');
  let snake, food, dir, score, gameLoopInterval;

  const initGame = () => {
    // Set canvas size responsively
    const size = Math.min(window.innerWidth * 0.9, 400);
    canvas.width = size;
    canvas.height = size;
    snake = [{x: 5, y: 5}];
    score = 0;
    dir = {x: 1, y: 0};
    placeFood();
    gameManager.showMessage('Score: 0');
    gameManager.gameControls.innerHTML = '';
    addMobileControls();
    clearInterval(gameLoopInterval);
    gameLoopInterval = setInterval(move, 120);
  };
  
  const placeFood = () => {
    const gridSize = Math.floor(canvas.width / 20);
    food = {
      x: Math.floor(Math.random() * (canvas.width / gridSize)),
      y: Math.floor(Math.random() * (canvas.height / gridSize))
    };
  };

  const draw = () => {
    ctx.fillStyle = '#1e293b';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#22c55e';
    snake.forEach(s => ctx.fillRect(s.x * 20, s.y * 20, 19, 19));
    ctx.fillStyle = '#ef4444';
    ctx.fillRect(food.x * 20, food.y * 20, 20, 20);
  };

  const move = () => {
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    const gridSize = Math.floor(canvas.width / 20);
    if (head.x < 0 || head.x >= gridSize || head.y < 0 || head.y >= gridSize || snake.some(s => s.x === head.x && s.y === head.y)) {
      clearInterval(gameLoopInterval);
      showModal(`Game Over! Your score: ${score}`, 'Play Again');
      return;
    }
    snake.unshift(head);
    if (head.x === food.x && head.y === food.y) {
      score++;
      gameManager.showMessage(`Score: ${score}`);
      placeFood();
    } else {
      snake.pop();
    }
    draw();
  };

  const addMobileControls = () => {
    gameManager.addControl('↑', () => { if (dir.y === 0) dir = {x: 0, y: -1}; });
    gameManager.addControl('↓', () => { if (dir.y === 0) dir = {x: 0, y: 1}; });
    gameManager.addControl('←', () => { if (dir.x === 0) dir = {x: -1, y: 0}; });
    gameManager.addControl('→', () => { if (dir.x === 0) dir = {x: 1, y: 0}; });
  };

  window.addEventListener('keydown', e => {
    if (e.key === 'ArrowUp' && dir.y === 0) dir = {x: 0, y: -1};
    if (e.key === 'ArrowDown' && dir.y === 0) dir = {x: 0, y: 1};
    if (e.key === 'ArrowLeft' && dir.x === 0) dir = {x: -1, y: 0};
    if (e.key === 'ArrowRight' && dir.x === 0) dir = {x: 1, y: 0};
  });
  
  initGame();
}

// Flappy Bird
function playFlappy() {
  const root = gameManager.gameRoot;
  root.innerHTML = `<canvas></canvas>`;
  const canvas = $('canvas', root);
  const ctx = canvas.getContext('2d');
  let bird, pipes, score, gameLoopInterval;

  const initGame = () => {
    canvas.width = Math.min(window.innerWidth * 0.9, 400);
    canvas.height = Math.min(window.innerHeight * 0.8, 600);
    bird = { x: 50, y: canvas.height / 2, vy: 0, size: 20 };
    pipes = [{ x: canvas.width, y: Math.random() * (canvas.height - 200) + 100 }];
    score = 0;
    gameManager.showMessage('Score: 0');
    gameManager.gameControls.innerHTML = '';
    gameManager.addControl('Jump', () => { bird.vy = -8; });
    clearInterval(gameLoopInterval);
    gameLoopInterval = setInterval(update, 20);
  };
  
  const draw = () => {
    ctx.fillStyle = '#87ceeb';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // Draw bird
    ctx.fillStyle = '#facc15';
    ctx.fillRect(bird.x, bird.y, bird.size, bird.size);
    // Draw pipes
    ctx.fillStyle = '#10b981';
    pipes.forEach(p => {
      ctx.fillRect(p.x, 0, 40, p.y - 50);
      ctx.fillRect(p.x, p.y + 50, 40, canvas.height - p.y - 50);
    });
  };

  const update = () => {
    bird.vy += 0.5;
    bird.y += bird.vy;
    
    // Move and spawn pipes
    pipes.forEach(p => {
      p.x -= 2;
    });
    if (pipes[0].x < -40) {
      pipes.shift();
      pipes.push({ x: canvas.width, y: Math.random() * (canvas.height - 200) + 100 });
      score++;
      gameManager.showMessage(`Score: ${score}`);
    }

    // Check for collision
    const head = { x: bird.x + bird.size, y: bird.y + bird.size };
    if (bird.y < 0 || head.y > canvas.height) {
      gameOver();
    }
    pipes.forEach(p => {
      if (bird.x < p.x + 40 && head.x > p.x) {
        if (bird.y < p.y - 50 || head.y > p.y + 50) {
          gameOver();
        }
      }
    });

    draw();
  };

  const gameOver = () => {
    clearInterval(gameLoopInterval);
    showModal(`Game Over! Your score: ${score}`, 'Play Again');
  };

  canvas.onclick = () => { bird.vy = -8; };
  initGame();
}

$('#year').textContent = new Date().getFullYear();
</script>
</body>
</html>
